# FPGA 통신 프로토콜 문서

## 1. 명령 코드 (Command Codes)

| 코드(이진) | 코드(십진) | 설명                |
|---------|---------|-------------------|
| 001     | 1       | 코트 경계선 감지        |
| 010     | 2       | 공 좌표 추적          |
| 011     | 3       | LED 표시 제어        |
| 100     | 4       | 기타 기능            |
| 101     | 5       | 판정 결과 전송         |
| 111     | 7       | 시스템 제어           |

## 2. 상태 플래그 (Status Flags)

### 2.1 코트 경계선 감지 상태 (001)
| 플래그(이진) | 설명               |
|---------|------------------|
| 00000   | 정상 감지            |
| 00001   | 경계선 불확실          |
| 00010   | 부분 감지            |
| 00011   | 재보정 필요           |
| 00100   | 조명 문제            |
| 00101   | 노이즈 간섭           |

### 2.2 공 추적 상태 (010)
| 플래그(이진) | 설명               |
|---------|------------------|
| 00000   | 정상 추적            |
| 00001   | 낮은 신뢰도           |
| 00010   | 추적 불확실           |
| 00011   | 추적 실패            |
| 00100   | 다중 객체 감지         |
| 00101   | 고속 이동 중          |
| 00110   | 화면 밖 예측 위치       |

### 2.3 LED 표시 상태 (011)
| 플래그(이진) | 설명               |
|---------|------------------|
| 00000   | 정상 작동            |
| 00001   | 점멸 모드            |
| 00010   | 색상 그라데이션 모드      |
| 00011   | 긴급 표시 모드         |
| 00100   | 전력 절약 모드         |
| 00101   | 시퀀스 모드           |

### 2.4 판정 결과 상태 (101)
| 플래그(이진) | 설명               |
|---------|------------------|
| 00000   | 확정 판정            |
| 00001   | 잠정 판정            |
| 00010   | 이의 제기 가능         |
| 00011   | 미확정 판정           |
| 00100   | 판정 검토 중          |
| 11111   | 시스템 판정 불가        |

## 3. 패킷 타입 (Packet Types)
| 코드(이진) | 설명            |
|---------|---------------|
| 00      | 데이터 패킷        |
| 01      | 제어 패킷         |
| 10      | 응답 패킷         |
| 11      | 긴급/우선 패킷      |

## 4. 데이터 필드 형식

### 4.1 코트 경계선 데이터 (8비트 제어 + 16비트 데이터)
```
[제어 8비트]  [데이터 16비트]
LLLL DDDD   XXXX XXXX YYYY YYYY

L: 선 타입 (0001: 베이스라인, 0010: 사이드라인, 0011: 서비스라인, 0100: 센터마크)
D: 감지 정확도 (0-15, 15가 가장 정확)
X: X좌표 값 (8비트)
Y: Y좌표 값 (8비트)
```

### 4.2 공 추적 데이터 (8비트 제어 + 16비트 데이터)
```
[제어 8비트]  [데이터 16비트]
IIII VVVV   XXXX XXXX YYYY YYYY

I: 공 ID (다중 공 추적 시 사용)
V: 속도 값 (0-15)
X: X좌표 값 (8비트)
Y: Y좌표 값 (8비트)
```

### 4.3 LED 제어 데이터 (8비트 제어 + 16비트 데이터)
```
[제어 8비트]  [데이터 16비트]
GGGG BBBB   CCCC CCCC PPPP PPPP

G: LED 그룹 ID
B: 밝기 값 (0-15)
C: 색상 코드 (8비트 RGB 압축)
P: 패턴 코드 (0: 고정, 1-255: 다양한 깜빡임 패턴)
```

### 4.4 판정 결과 데이터 (8비트 제어 + 16비트 데이터)
```
[제어 8비트]  [데이터 16비트]
TTTT CCCC   DDDD DDDD DDDD DDDD

T: 판정 타입 (0001: 인/아웃, 0010: 라인 터치, 0011: 네트, 0100: 풋폴트)
C: 신뢰도 카테고리 (0-15)
D: 세부 판정 데이터 (타입별 다른 의미)
```

## 5. 사용 예제

### 5.1 정상 공 추적 데이터 (이진 표현)
```
010 00000 00 00010100 0110101000101101
│   │     │  │      │ └─────┬──────┘
│   │     │  │      │       └─ Y좌표: 45 (00101101)
│   │     │  │      └─ X좌표: 106 (01101010)
│   │     │  └─ 공 ID: 1, 속도: 4 (00010100)
│   │     └─ 데이터 패킷
│   └─ 정상 추적 상태
└─ 공 추적 명령
```

### 5.2 경계선 감지 오류 (이진 표현)
```
001 00100 00 00010001 0010111100000011
│   │     │  │      │ └─────┬──────┘
│   │     │  │      │       └─ Y좌표: 3 (00000011)
│   │     │  │      └─ X좌표: 47 (00101111)
│   │     │  └─ 선 타입: 베이스라인, 정확도: 1 (00010001)
│   │     └─ 데이터 패킷
│   └─ 조명 문제 상태
└─ 코트 경계선 감지 명령
```

### 5.3 시스템 리셋 명령 (이진 표현)
```
111 00000 01 11111111 0000000000000000
│   │     │  │        └─ 파라미터: 0 (모든 설정 초기화)
│   │     │  └─ 동작 코드: 시스템 리셋 (11111111)
│   │     └─ 제어 패킷
│   └─ 일반 우선순위
└─ 시스템 제어 명령
```

## 6. 에러 처리 코드

| 명령 코드 | 상태 플래그 | 설명            |
|--------|---------|---------------|
| 000    | 11111   | 패킷 오류         |
| 110    | 00001   | 재전송 요청        |
| 110    | 00010   | 타임아웃 발생       |
| 110    | 00011   | 체크섬 불일치       |
| 110    | 11111   | 심각한 시스템 오류    | 